/**
 * 
 * @package     local_certimagegen
 * @copyright   2026 Rudraksh Batra <batra.rudraksh@gmail.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_certimagegen/share",[],function(){"use strict";const t=()=>{document.querySelectorAll(".openShare").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".bottombtn")?.querySelector(".shareURL"),n=t?.value||"";if(navigator.share)return void navigator.share({title:"Certificate Share URL",url:n}).catch(()=>{});const o=encodeURIComponent(n),c=document.getElementById("attachmsg")?.value||"Check this out:";l("fbook","https://www.facebook.com/sharer.php?u="+o),l("linked","https://www.linkedin.com/sharing/share-offsite/?url="+o),l("whatsapp","https://wa.me/?text="+encodeURIComponent(c)+"%20"+o),l("twitterx","https://twitter.com/share?text="+encodeURIComponent(c)+"&url="+o);const r=document.getElementById("shareLink");r&&(r.value=n),s(!0)})})},e=()=>{document.querySelector(".close-btn")?.addEventListener("click",()=>s(!1)),document.getElementById("copyBtn")?.addEventListener("click",async()=>{const t=document.getElementById("shareLink");t&&await navigator.clipboard.writeText(t.value)})},n=()=>{document.querySelectorAll(".download-locked").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.cmid,n=document.getElementById("imgdata"+e);n&&(n.innerHTML='<div class="certimg" style="height:240px;display:grid;justify-content:center;"><div class="loader"></div><span>Generating imageâ€¦</span></div>',setTimeout(()=>window.location.reload(),5e3))})})},i=()=>{document.querySelectorAll(".cert-image").forEach(t=>{const e=t.dataset.issuedSrc;if(!e)return;const n=t.closest(".certimg");if(!n)return;const o=n.querySelector(".cert-loader");if(!o)return;const c=()=>{const n=new Image;n.onload=()=>{t.src=e+"&ts="+Date.now(),o.style.display="none",clearInterval(r)},n.onerror=()=>{o.style.display="flex"},n.src=e+"&check="+Date.now()};c();const r=setInterval(c,3e3)})},s=t=>{const e=document.getElementById("shareModal");e&&(e.style.display=t?"block":"none")},l=(t,e)=>{const n=document.getElementById(t);n&&n.setAttribute("href",e)};return{init:function(){console.log("share module loaded"),i(),t(),e(),n()}}});
